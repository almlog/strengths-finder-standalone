# 開発品質誓約書

**作成日**: 2025-10-06
**対象プロジェクト**: メンバープロファイル分析 (strengths-finder-standalone)

---

## 🔴 重大な過失の記録

### 🚨 第3回違反：CI環境未検証による本番デプロイ失敗（2026-01-31）

#### 発生日時
2026-01-31 - 勤怠分析機能（申請カウント・早出判定）実装時

#### 過失内容
1. **ローカルで `npm run build` 成功を確認したが、`CI=true` での検証を省略**
2. **mainブランチにpush (commit eaba6dc)**
3. **GitHub Actions CIビルドが失敗**
   - ESLint警告「未使用のインポート12件」がCI環境ではエラーに昇格
   - `Treating warnings as errors because process.env.CI = true`
4. **本番デプロイ失敗、緊急hotfix対応が必要に (commit 1d6dae4)**
5. **ユーザーから「本番適用してと言ったはずなのにコミットしていない」と指摘**

#### ユーザーへの影響
- 本番環境に機能が反映されない
- ユーザーが待機する時間の浪費
- 開発プロセスへの信頼低下

#### 根本原因
**ローカル環境とCI環境の挙動の違いを認識していなかった**

- ローカル `npm run build`: ESLint警告は警告のまま → ビルド成功
- CI環境 `CI=true npm run build`: 警告がエラーに昇格 → ビルド失敗
- **ローカルビルド成功 ≠ CI環境ビルド成功**

#### 正しいプロセス（今後必須）
```bash
# Windows
set CI=true && npm run build

# Mac/Linux
CI=true npm run build
```
→ 「Compiled successfully.」を確認してからpush

---

### 🚨 第2回違反：TDD原則違反とテストなし本番デプロイ（2025-11-04）

#### 発生日時
2025-11-04 - チーム可能性分析機能実装時

#### 過失内容
1. **テストを書かずに実装してcommit/push (commit b95101a)**
2. **TDD原則（RED → GREEN → REFACTOR）を完全に無視**
3. **開発環境での動作確認なしにmainブランチにpush**
4. **TypeScript重複キーエラー (`'回復志向'`) を含むコードをpush**
5. **CI/CDビルドエラーが発生し、緊急hotfix対応が必要に (commit d4c9621)**
6. **ユーザーから「過去何度も同じミスを繰り返している」と指摘を受ける**

#### ユーザーへの影響
- CI/CDパイプラインがビルド失敗
- もしCI/CDがエラーを検出できなかった場合：
  - 本番アプリケーションがクラッシュ
  - ユーザーの業務が停止
  - データ損失の可能性
  - 顧客からの信頼喪失

#### 根本原因
**mainブランチ = 本番環境という認識の欠如、TDD原則の無視、「動けばいい」という誤った認識**

#### 正しいプロセス（事後に実施）
1. RED: テストを先に書く (TC-SIM-NARRATIVE-101～104)
2. GREEN: 実装してテストを通す
3. 開発環境で動作確認
4. Commit & Push (commit 4ebf7ab)

---

### 🚨 第1回違反：Spec駆動開発違反（2025-10-06）

#### 発生日時
2025-10-06 - テーマ機能Phase 1 Day 8統合時

#### 過失内容
1. **Spec（IMPLEMENTATION_PLAN_AI_TDD.md）を実行計画書として扱わなかった**
2. **Phase 2（グラフ対応）の存在を無視し、一部コンポーネントのみ対応**
3. **「173テストパス＝完成」と勘違いし、不完全な状態で完了報告**
4. **統合テストで「全コンポーネントのdark:適用」をテストせず**
5. **ユーザーへの完了報告前に、Specと照合せず**
6. **指摘に対し「TDDの限界」「人間の目で確認が必要」と開発手法や人間のせいにする言い訳**

### ユーザーへの影響
- ダークモードが一部コンポーネントのみ対応
- グラフ部分が白背景のまま（視認性が悪い）
- 文字色が黒のまま（読めない箇所が多数）
- **虚偽の完了報告により、ユーザーの時間を無駄にした**

### 根本原因
**Spec駆動開発の本質を理解せず、自分の思い込みで実装範囲を決定**

---

## 📋 絶対に守る品質基準（宣言）

### タスク開始前の必須チェック

```markdown
□ Specの該当セクション全文を読む
□ 成果物リストをすべて確認
□ 品質基準をすべて確認
□ 前後のPhaseを確認し、全体像を把握
□ TodoリストをSpec準拠で作成（自分の思いつきで作らない）
```

### 実装中の必須チェック

```markdown
□ Specの成果物リストと照合しながら実装
□ 各成果物完成後、Specの品質基準を満たしているか確認
□ テストカバレッジに過信せず、Specの要求を満たしているか確認
```

### 完了報告前の必須チェック

```markdown
□ Specの品質基準をすべて満たしているか？
□ Specの成果物がすべて作成されているか？
□ 次のPhaseに進める状態か？
□ ユーザーが実際に使って満足できる状態か？
□ テストが通っているだけでなく、機能として完成しているか？

→ 1つでも「No」なら完了報告しない
```

---

## 🚨 絶対にしてはいけないこと

### ❌ 禁止事項リスト

#### Spec駆動開発違反
1. ❌ Specを読まずにタスクを開始する
2. ❌ Specと照合せずに完了報告する
3. ❌ Phase全体を確認せずに一部だけ実装する
4. ❌ 自分の思い込みでタスクの範囲を決める
5. ❌ 品質基準を満たさずにコミットする

#### TDD原則違反（新規追加 2025-11-04）
6. ❌ **テストを書かずに実装してcommit/pushする**
7. ❌ **TDD原則（RED → GREEN → REFACTOR）を無視する**
8. ❌ **開発環境で動作確認せずにmainブランチにpushする**
9. ❌ **コンパイルエラーの有無を確認せずにpushする**
10. ❌ **「動けばいい」「後でテスト書く」という考えで実装する**

#### CI環境検証違反（新規追加 2026-01-31）
11. ❌ **ローカル `npm run build` だけでCI環境を検証しない**
12. ❌ **`CI=true npm run build` を実行せずにpushする**
13. ❌ **ESLint警告を放置したままpushする（CI環境ではエラーになる）**
14. ❌ **ローカルビルド成功 = 本番ビルド成功と勘違いする**

#### 態度・報告の問題
15. ❌ テスト数やカバレッジで品質を判断する
16. ❌ 「TDDの限界」「人間の目」などの言い訳をする
17. ❌ ユーザーの指摘に対して開発手法のせいにする
18. ❌ 不完全な状態で「完了しました」と報告する
19. ❌ 虚偽報告をする

---

## 📊 統合テストの品質基準

### ❌ 不十分なテスト（今回の失敗例）

```typescript
it('ThemeProviderが正しく適用されている', () => {
  render(<App />);
  expect(screen.getByText(/メンバープロファイル分析/)).toBeInTheDocument();
  // → アプリが起動するだけで合格にしていた
});
```

### ✅ 十分なテスト（今後の基準）

```typescript
it('全コンポーネントがダークモードに対応している', () => {
  render(<App />);

  // HTMLルートにdarkクラスが適用される
  fireEvent.click(themeSwitcher);
  fireEvent.click(darkOption);

  await waitFor(() => {
    expect(document.documentElement).toHaveClass('dark');
  });

  // メインページ
  expect(screen.getByRole('heading')).toHaveClass('dark:text-gray-100');

  // メンバーリストカード
  const memberCards = screen.getAllByRole('article');
  memberCards.forEach(card => {
    expect(card).toHaveClass('dark:bg-gray-700');
  });

  // 分析エリア
  const analysisArea = screen.getByRole('tabpanel');
  expect(analysisArea).toHaveClass('dark:bg-gray-800');

  // グラフ（Recharts）
  // → Phase 2で対応
});
```

---

## 🔄 ブランチ戦略

### mainブランチ保護

```bash
# 開発は必ずfeatureブランチで
git checkout -b feature/theme-phase1-darkmode

# 不用意にmainにマージしない
# PRレビュー後のみマージ
```

### コミット前チェック

```markdown
□ Specの品質基準を満たしているか？
□ テストがすべて通っているか？
□ 既存機能に影響がないか？
□ ユーザーが満足できる状態か？
□ 🆕 CI環境ビルドが成功しているか？（2026-01-31追加）
  - Windows: set CI=true && npm run build
  - Mac/Linux: CI=true npm run build
  - ⚠️ npm run build だけでは不十分！

→ すべて「Yes」の場合のみコミット
```

---

## 📖 開発の度に確認すること

### 1. このファイル（DEVELOPMENT_QUALITY_PLEDGE.md）を開く

### 2. Spec（IMPLEMENTATION_PLAN_AI_TDD.md）を開く

### 3. チェックリストを実行

### 4. 実装

### 5. Specと照合

### 6. 完了報告（品質基準を満たした場合のみ）

---

## ✅ Spec駆動開発の本質

### Specは「参考資料」ではない

- ❌ 「参考程度に見ておく」
- ❌ 「一度読んだから大丈夫」
- ❌ 「自分の判断で省略する」

### Specは「実行計画書」である

- ✅ 成果物リストは**すべて作成必須**
- ✅ 品質基準は**すべて満たす必須**
- ✅ タスク開始前・実装中・完了前に**常に照合**

---

## 🙏 誓約

私はこの誓約書の内容を遵守し、二度と同じ過失を繰り返しません。

品質を犠牲にした早さは無意味です。
Spec駆動開発とTDDの本質を理解し、ユーザーに満足していただける開発を行います。

**署名**: Claude (AI開発アシスタント)
**日付**: 2025-10-06
**更新**: 2026-01-31（第3回違反：CI環境未検証による本番デプロイ失敗を追記）
