# Firebase Authentication æŠ€è¡“ä»•æ§˜æ›¸

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**ä½œæˆæ—¥**: 2025-12-23
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: StrengthsFinderçµ±åˆåˆ†æãƒ„ãƒ¼ãƒ«
**æ‹…å½“**: SUZUKI Shunpei

---

## ğŸ“‹ ç›®æ¬¡

1. [ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­è¨ˆï¼ˆGitHub Pageså¯¾å¿œï¼‰](#ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­è¨ˆgithub-pageså¯¾å¿œ)
2. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
4. [ç’°å¢ƒæ§‹æˆ](#ç’°å¢ƒæ§‹æˆ)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«](#ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«)
6. [èªè¨¼ãƒ•ãƒ­ãƒ¼](#èªè¨¼ãƒ•ãƒ­ãƒ¼)
7. [APIè¨­è¨ˆ](#apiè¨­è¨ˆ)
8. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ)
9. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](#ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)
10. [ãƒ†ã‚¹ãƒˆæˆ¦ç•¥](#ãƒ†ã‚¹ãƒˆæˆ¦ç•¥)

---

## ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­è¨ˆï¼ˆGitHub Pageså¯¾å¿œï¼‰

### é‡è¦ãªåˆ¶ç´„äº‹é …

**æœ¬ã‚¢ãƒ—ãƒªã¯GitHub Pagesã®ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™ã€‚**

| ç’°å¢ƒ | ãƒ™ãƒ¼ã‚¹URL |
|-----|----------|
| **æœ¬ç•ª** | `https://almlog.github.io/strengths-finder-standalone/` |
| **ãƒ­ãƒ¼ã‚«ãƒ«** | `http://localhost:3006/strengths-finder-standalone/` |

### BrowserRouterã®basenameè¨­å®š

```typescript
// src/App.tsx
<BrowserRouter basename="/strengths-finder-standalone">
  <Routes>
    <Route path="/login" element={<LoginPage />} />
    {/* ä»–ã®ãƒ«ãƒ¼ãƒˆ */}
  </Routes>
</BrowserRouter>
```

### ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…ãƒ«ãƒ¼ãƒ«

| å®Ÿè£…æ–¹æ³• | basenameé©ç”¨ | ä½¿ç”¨å¯å¦ |
|---------|-------------|---------|
| `<Link to="/login">` | âœ… è‡ªå‹•é©ç”¨ | âœ… æ¨å¥¨ |
| `navigate('/login')` | âœ… è‡ªå‹•é©ç”¨ | âœ… æ¨å¥¨ |
| `<Navigate to="/login">` | âœ… è‡ªå‹•é©ç”¨ | âœ… æ¨å¥¨ |
| `<a href="/login">` | âŒ é©ç”¨ã•ã‚Œãªã„ | âŒ ç¦æ­¢ |
| `window.location.href = '/login'` | âŒ é©ç”¨ã•ã‚Œãªã„ | âŒ ç¦æ­¢ |

### æ­£ã—ã„å®Ÿè£…ä¾‹

```typescript
// âœ… æ­£ã—ã„: Link ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
import { Link } from 'react-router-dom';
<Link to="/login">ãƒ­ã‚°ã‚¤ãƒ³</Link>
// â†’ /strengths-finder-standalone/login

// âœ… æ­£ã—ã„: useNavigate ãƒ•ãƒƒã‚¯
import { useNavigate } from 'react-router-dom';
const navigate = useNavigate();
navigate('/');
// â†’ /strengths-finder-standalone/

// âœ… æ­£ã—ã„: Navigate ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
import { Navigate } from 'react-router-dom';
<Navigate to="/login" replace />
// â†’ /strengths-finder-standalone/login
```

### é–“é•ã£ãŸå®Ÿè£…ä¾‹ï¼ˆçµ¶å¯¾ã«ä½¿ã‚ãªã„ï¼‰

```typescript
// âŒ é–“é•ã„: aã‚¿ã‚°ã®href
<a href="/login">ãƒ­ã‚°ã‚¤ãƒ³</a>
// â†’ /loginï¼ˆbasenameãŒé©ç”¨ã•ã‚Œãªã„ï¼‰

// âŒ é–“é•ã„: window.location
window.location.href = '/login';
// â†’ /loginï¼ˆbasenameãŒé©ç”¨ã•ã‚Œãªã„ï¼‰

// âŒ é–“é•ã„: ãƒ‘ã‚¹ã«basenameã‚’å«ã‚ã‚‹
<Link to="/strengths-finder-standalone/login">
// â†’ /strengths-finder-standalone/strengths-finder-standalone/loginï¼ˆäºŒé‡é©ç”¨ï¼‰
```

### å¤–éƒ¨ãƒªãƒ³ã‚¯ã®ä¾‹å¤–

å¤–éƒ¨URLã‚„mailtoãƒªãƒ³ã‚¯ã¯`<a>`ã‚¿ã‚°ã‚’ä½¿ç”¨ã—ã¦OK:

```typescript
// âœ… å¤–éƒ¨ãƒªãƒ³ã‚¯ã¯aã‚¿ã‚°ã‚’ä½¿ç”¨
<a href="mailto:admin@example.com">ãŠå•ã„åˆã‚ã›</a>
<a href="https://firebase.google.com">Firebase Docs</a>
```

---

## ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReact + TypeScriptï¼‰                     â”‚
â”‚ GitHub Pages: https://almlog.github.io/...              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å±¤ï¼ˆReact Routerï¼‰                       â”‚ â”‚
â”‚ â”‚  - PublicRoute: /login, /register, /set-password    â”‚ â”‚
â”‚ â”‚  - PrivateRoute: /dashboard, /*                     â”‚ â”‚
â”‚ â”‚  - AdminRoute: /manager-mode, /team-simulation      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â†•                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ èªè¨¼å±¤ï¼ˆCustom Hooksï¼‰                               â”‚ â”‚
â”‚ â”‚  - useAuth: èªè¨¼çŠ¶æ…‹ç®¡ç†                            â”‚ â”‚
â”‚ â”‚  - PrivateRoute: ãƒ«ãƒ¼ãƒˆä¿è­·                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â†•                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Firebase SDK                                        â”‚ â”‚
â”‚ â”‚  - auth: Authenticationç®¡ç†                         â”‚ â”‚
â”‚ â”‚  - signInWithEmailAndPassword                       â”‚ â”‚
â”‚ â”‚  - sendSignInLinkToEmail                            â”‚ â”‚
â”‚ â”‚  - onAuthStateChanged                               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â†•                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†• HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firebase Authenticationï¼ˆå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼‰                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœ¬ç•ªç’°å¢ƒ:                                                â”‚
â”‚  - Firebase Production Project                          â”‚
â”‚  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†           â”‚
â”‚                                                          â”‚
â”‚ é–‹ç™ºç’°å¢ƒ:                                                â”‚
â”‚  - Firebase Emulator Suite (localhost:9099)             â”‚
â”‚  - ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Œçµã€æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã«å½±éŸ¿ãªã—                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆ

```
Presentation Layer (UI Components)
â”œâ”€â”€ RegisterPage.tsx
â”œâ”€â”€ SetPasswordPage.tsx
â”œâ”€â”€ LoginPage.tsx
â””â”€â”€ PrivateRoute.tsx

Application Layer (Custom Hooks)
â””â”€â”€ useAuth.ts

Infrastructure Layer (External Services)
â”œâ”€â”€ firebase.ts (Firebaseè¨­å®š)
â””â”€â”€ domainValidator.ts (ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼)
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|-----|-----------|------|
| React | 19.1.1 | UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| TypeScript | 4.9.5 | å‹å®‰å…¨æ€§ |
| React Router | 6.x | ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° |
| Tailwind CSS | 3.4.1 | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° |

### èªè¨¼

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|-----|-----------|------|
| Firebase SDK | ^10.x | Authentication |
| Firebase Admin SDK | ^12.x | ç®¡ç†è€…ç”¨CLI |

### é–‹ç™ºãƒ„ãƒ¼ãƒ«

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|-----|-----------|------|
| Firebase Emulator Suite | latest | ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º |
| Jest | ^27.5.2 | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ |
| React Testing Library | ^16.3.0 | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ |

---

## ç’°å¢ƒæ§‹æˆ

### ç’°å¢ƒã®ç¨®é¡

| ç’°å¢ƒ | URL | Firebase | ç”¨é€” |
|-----|-----|----------|------|
| **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º** | localhost:3006 | Emulator | é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆ |
| **æœ¬ç•ª** | almlog.github.io/... | Production | å®Ÿé‹ç”¨ |

### ç’°å¢ƒå¤‰æ•°

#### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼ˆ.env.localï¼‰

```bash
# Firebase Emulatorä½¿ç”¨ãƒ•ãƒ©ã‚°
REACT_APP_USE_EMULATOR=true

# Firebaseè¨­å®šï¼ˆæœ¬ç•ªã¨åŒã˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰
REACT_APP_FIREBASE_API_KEY=your-api-key
REACT_APP_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com
REACT_APP_FIREBASE_PROJECT_ID=your-project-id
REACT_APP_FIREBASE_STORAGE_BUCKET=your-project.appspot.com
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=your-sender-id
REACT_APP_FIREBASE_APP_ID=your-app-id
```

#### æœ¬ç•ªç’°å¢ƒï¼ˆGitHub Secretsï¼‰

```bash
# Firebase Emulatorä½¿ç”¨ãƒ•ãƒ©ã‚°
REACT_APP_USE_EMULATOR=false

# Firebaseè¨­å®šï¼ˆæœ¬ç•ªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰
REACT_APP_FIREBASE_API_KEY=***
REACT_APP_FIREBASE_AUTH_DOMAIN=***
REACT_APP_FIREBASE_PROJECT_ID=***
REACT_APP_FIREBASE_STORAGE_BUCKET=***
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=***
REACT_APP_FIREBASE_APP_ID=***
```

### Firebase Emulatorè¨­å®š

```json
// firebase.json
{
  "emulators": {
    "auth": {
      "port": 9099
    },
    "ui": {
      "enabled": true,
      "port": 4000
    }
  }
}
```

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### 1. Emulatorã®èµ·å‹•ï¼ˆãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã‚ã‚Šï¼‰

```bash
# ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã‚‹Emulatorèµ·å‹•ï¼ˆæ¨å¥¨ï¼‰
npm run emulator

# ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ãªã„ã‚¯ãƒªãƒ¼ãƒ³èµ·å‹•
npm run emulator:fresh
```

**ãƒ‡ãƒ¼ã‚¿ä¿å­˜å…ˆ**: `.emulator-data/` ï¼ˆ.gitignoreæ¸ˆã¿ï¼‰

#### 2. ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ

```bash
# ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
npm run create:user

# ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
npm run create:admin
```

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±**:
| é …ç›® | å€¤ |
|------|-----|
| Email | `suzuki.shunpei@altx.co.jp` |
| Password | `password123` |

#### 3. ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ç®¡ç†è€…åˆ¤å®š

Firebase Emulatorã§ã¯ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ¬ãƒ¼ãƒ ã®è¨­å®šãŒåˆ¶é™ã•ã‚Œã‚‹ãŸã‚ã€
`useAuth.ts` ã® `LOCAL_ADMIN_EMAILS` ã§ç®¡ç†è€…ã‚’åˆ¤å®šã—ã¾ã™ã€‚

```typescript
// src/hooks/useAuth.ts
const LOCAL_ADMIN_EMAILS = ['suzuki.shunpei@altx.co.jp'];

// REACT_APP_USE_EMULATOR=true ã®å ´åˆã®ã¿é©ç”¨
if (
  process.env.REACT_APP_USE_EMULATOR === 'true' &&
  firebaseUser.email &&
  LOCAL_ADMIN_EMAILS.includes(firebaseUser.email)
) {
  userRole = 'admin';
}
```

**æœ¬ç•ªç’°å¢ƒã§ã¯**:
- ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ¬ãƒ¼ãƒ ï¼ˆ`role: admin`ï¼‰ã§åˆ¤å®š
- `LOCAL_ADMIN_EMAILS` ã¯ç„¡è¦–ã•ã‚Œã‚‹

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆFirebase Authï¼‰

```typescript
interface FirebaseUser {
  uid: string;                    // ä¸€æ„è­˜åˆ¥å­
  email: string;                  // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ@altx.co.jpï¼‰
  emailVerified: boolean;         // ãƒ¡ãƒ¼ãƒ«ç¢ºèªæ¸ˆã¿ãƒ•ãƒ©ã‚°
  metadata: {
    creationTime: string;         // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ—¥æ™‚
    lastSignInTime: string;       // æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚
  };
}
```

### ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ¬ãƒ¼ãƒ ï¼ˆãƒ­ãƒ¼ãƒ«æƒ…å ±ï¼‰

```typescript
interface CustomClaims {
  role: 'admin' | 'user';         // ãƒ­ãƒ¼ãƒ«
}

// IDãƒˆãƒ¼ã‚¯ãƒ³ã«å«ã¾ã‚Œã‚‹
interface IDTokenResult {
  token: string;
  claims: {
    email: string;
    role: 'admin' | 'user';       // ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ¬ãƒ¼ãƒ 
    // ãã®ä»–ã®Firebaseæ¨™æº–ã‚¯ãƒ¬ãƒ¼ãƒ 
  };
}
```

### èªè¨¼çŠ¶æ…‹ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ï¼‰

```typescript
interface AuthState {
  user: User | null;              // Firebaseãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
  role: 'admin' | 'user' | null;  // ãƒ­ãƒ¼ãƒ«
  loading: boolean;               // èª­ã¿è¾¼ã¿ä¸­ãƒ•ãƒ©ã‚°
  isAuthenticated: boolean;       // èªè¨¼æ¸ˆã¿ãƒ•ãƒ©ã‚°
  isAdmin: boolean;               // ç®¡ç†è€…ãƒ•ãƒ©ã‚°
}
```

---

## èªè¨¼ãƒ•ãƒ­ãƒ¼

### 1. ç™»éŒ²ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. RegisterPage                     â”‚
â”‚    - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›             â”‚
â”‚    - ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼ï¼ˆ@altx.co.jpï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ sendSignInLinkToEmail()
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Firebase Authentication          â”‚
â”‚    - Email Linkç”Ÿæˆ                 â”‚
â”‚    - ãƒ¡ãƒ¼ãƒ«é€ä¿¡                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ãƒ¡ãƒ¼ãƒ«å—ä¿¡                        â”‚
â”‚    - ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. SetPasswordPage                  â”‚
â”‚    - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèª             â”‚
â”‚    - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ï¼ˆ8æ–‡å­—ä»¥ä¸Šï¼‰    â”‚
â”‚    - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ signInWithEmailLink()
         â”‚ + linkWithCredential()
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Firebase Authentication          â”‚
â”‚    - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ                  â”‚
â”‚    - Email/Passwordèªè¨¼ãƒªãƒ³ã‚¯       â”‚
â”‚    - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ­ãƒ¼ãƒ«: user         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. LoginPage                        â”‚
â”‚    - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›             â”‚
â”‚    - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ signInWithEmailAndPassword()
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Firebase Authentication          â”‚
â”‚    - èªè¨¼æƒ…å ±æ¤œè¨¼                    â”‚
â”‚    - IDãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. useAuth Hook                     â”‚
â”‚    - onAuthStateChangedç›£è¦–         â”‚
â”‚    - IDãƒˆãƒ¼ã‚¯ãƒ³å–å¾—                 â”‚
â”‚    - ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ¬ãƒ¼ãƒ ï¼ˆãƒ­ãƒ¼ãƒ«ï¼‰å–å¾— â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æ¨©é™ãƒã‚§ãƒƒã‚¯ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼        â”‚
â”‚ /manager-mode   â”‚
â”‚ ã«ã‚¢ã‚¯ã‚»ã‚¹      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. PrivateRoute Component           â”‚
â”‚    - useAuth()ã§èªè¨¼çŠ¶æ…‹å–å¾—        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
      èªè¨¼æ¸ˆã¿ï¼Ÿ
         â”œâ”€ No â†’ LoginPageã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
         â”‚
         â””â”€ Yes
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ¨©é™ãƒã‚§ãƒƒã‚¯                      â”‚
â”‚    - requireAdmin === true?         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
      Adminï¼Ÿ
         â”œâ”€ No â†’ ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦ç”»é¢
         â”‚
         â””â”€ Yes â†’ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¡¨ç¤º
```

---

## APIè¨­è¨ˆ

### Firebase Authentication API

#### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ï¼ˆEmail Linké€ä¿¡ï¼‰

```typescript
import { sendSignInLinkToEmail } from 'firebase/auth';

const actionCodeSettings = {
  url: `${window.location.origin}/strengths-finder-standalone/set-password`,
  handleCodeInApp: true,
};

await sendSignInLinkToEmail(auth, email, actionCodeSettings);
```

#### 2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆï¼‰

```typescript
import {
  signInWithEmailLink,
  linkWithCredential,
  EmailAuthProvider
} from 'firebase/auth';

// Email Linkã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³
const result = await signInWithEmailLink(auth, email, window.location.href);

// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚’ãƒªãƒ³ã‚¯
const credential = EmailAuthProvider.credential(email, password);
await linkWithCredential(result.user, credential);
```

#### 3. ãƒ­ã‚°ã‚¤ãƒ³

```typescript
import { signInWithEmailAndPassword } from 'firebase/auth';

await signInWithEmailAndPassword(auth, email, password);
```

#### 4. ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

```typescript
import { signOut } from 'firebase/auth';

await signOut(auth);
```

#### 5. èªè¨¼çŠ¶æ…‹ç›£è¦–

```typescript
import { onAuthStateChanged } from 'firebase/auth';

const unsubscribe = onAuthStateChanged(auth, async (user) => {
  if (user) {
    const idTokenResult = await user.getIdTokenResult();
    const role = idTokenResult.claims.role || 'user';
    // çŠ¶æ…‹æ›´æ–°
  } else {
    // æœªèªè¨¼
  }
});
```

### Firebase Admin SDKï¼ˆç®¡ç†è€…CLIï¼‰

#### ãƒ­ãƒ¼ãƒ«è¨­å®š

```javascript
const admin = require('firebase-admin');

// ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ä»˜ä¸
await admin.auth().setCustomUserClaims(uid, { role: 'admin' });

// ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ä»˜ä¸
await admin.auth().setCustomUserClaims(uid, { role: 'user' });
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 1. ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¶é™

**å®Ÿè£…ç®‡æ‰€**: `src/utils/auth/domainValidator.ts`

```typescript
const ALLOWED_DOMAINS = ['altx.co.jp'];

export function isAllowedDomain(email: string): boolean {
  const domain = email.split('@')[1];
  return ALLOWED_DOMAINS.includes(domain);
}
```

**é©ç”¨ç®‡æ‰€**:
- ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆRegisterPageï¼‰
- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰æ¤œè¨¼ã¯ä¸å¯ï¼ˆGitHub Pagesï¼‰
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ã¿ã§å¼·åˆ¶

### 2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼

**Firebaseæ¨™æº–**:
- æœ€å°é•·: 6æ–‡å­—ï¼ˆFirebaseæ¨™æº–ï¼‰
- æœ¬ã‚¢ãƒ—ãƒª: 8æ–‡å­—ä»¥ä¸Šã‚’æ¨å¥¨

**å®Ÿè£…**:
```typescript
// HTML5ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
<input type="password" minLength={8} required />

// JavaScriptãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
if (password.length < 8) {
  setError('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã«ã—ã¦ãã ã•ã„');
  return;
}
```

### 3. ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRBACï¼‰

**å®Ÿè£…ç®‡æ‰€**: `src/components/auth/PrivateRoute.tsx`

```typescript
if (requireAdmin && !isAdmin) {
  return <AccessDeniedPage />;
}
```

**Custom Claims**:
- Firebase Admin SDKã§ã®ã¿è¨­å®šå¯èƒ½
- IDãƒˆãƒ¼ã‚¯ãƒ³ã«å«ã¾ã‚Œã‚‹ï¼ˆæ”¹ã–ã‚“ä¸å¯ï¼‰
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§æ¤œè¨¼

### 4. HTTPSé€šä¿¡

- GitHub Pages: å¼·åˆ¶çš„ã«HTTPS
- Firebase: ã™ã¹ã¦ã®é€šä¿¡ãŒHTTPS

### 5. XSS/CSRFå¯¾ç­–

- React: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§XSSå¯¾ç­–
- Firebase: CSRFãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•ç®¡ç†

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### Firebase Authenticationã‚¨ãƒ©ãƒ¼

| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | æ„å‘³ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|------------|------|------------------|
| `auth/invalid-email` | ç„¡åŠ¹ãªãƒ¡ãƒ¼ãƒ« | ç„¡åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™ |
| `auth/invalid-credential` | èªè¨¼æƒ…å ±ä¸æ­£ | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ |
| `auth/user-not-found` | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸å­˜åœ¨ | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ |
| `auth/wrong-password` | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸æ­£ | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ |
| `auth/too-many-requests` | è©¦è¡Œå›æ•°è¶…é | ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°ãŒå¤šã™ãã¾ã™ã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ |
| `auth/invalid-action-code` | ãƒªãƒ³ã‚¯ç„¡åŠ¹ | ãƒªãƒ³ã‚¯ãŒç„¡åŠ¹ã¾ãŸã¯æœŸé™åˆ‡ã‚Œã§ã™ |
| `auth/expired-action-code` | ãƒªãƒ³ã‚¯æœŸé™åˆ‡ã‚Œ | ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™ |
| `auth/email-already-in-use` | ãƒ¡ãƒ¼ãƒ«é‡è¤‡ | ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ |
| `auth/weak-password` | å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¼±ã™ãã¾ã™ |

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…

```typescript
try {
  await signInWithEmailAndPassword(auth, email, password);
} catch (err: any) {
  console.error(err);
  if (err.code === 'auth/invalid-credential') {
    setError('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
  } else if (err.code === 'auth/user-not-found') {
    setError('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
  } else {
    setError('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
}
```

---

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

**å¯¾è±¡**:
- `useAuth.ts`
- `domainValidator.ts`

**ãƒ„ãƒ¼ãƒ«**: Jest

**ä¾‹**:
```typescript
describe('domainValidator', () => {
  it('@altx.co.jp ã®ãƒ¡ãƒ¼ãƒ«ã‚’è¨±å¯ã™ã‚‹', () => {
    expect(isAllowedDomain('user@altx.co.jp')).toBe(true);
  });

  it('@gmail.com ã®ãƒ¡ãƒ¼ãƒ«ã‚’æ‹’å¦ã™ã‚‹', () => {
    expect(isAllowedDomain('user@gmail.com')).toBe(false);
  });
});
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ

**å¯¾è±¡**:
- `RegisterPage.tsx`
- `LoginPage.tsx`
- `PrivateRoute.tsx`

**ãƒ„ãƒ¼ãƒ«**: React Testing Library

**ä¾‹**:
```typescript
describe('LoginPage', () => {
  it('æ­£ã—ã„èªè¨¼æƒ…å ±ã§ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ', async () => {
    // ãƒ¢ãƒƒã‚¯è¨­å®š
    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    // å…¥åŠ›
    // é€ä¿¡
    // æ¤œè¨¼
  });
});
```

### E2Eãƒ†ã‚¹ãƒˆï¼ˆæ‰‹å‹•ï¼‰

**ã‚·ãƒŠãƒªã‚ª**:
1. ç™»éŒ²ãƒ•ãƒ­ãƒ¼
2. ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼
3. æ¨©é™ãƒã‚§ãƒƒã‚¯
4. ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

---

## ç®¡ç†è€…æ¨©é™ç®¡ç†

### æ¦‚è¦

æœ¬ç•ªç’°å¢ƒã§ã®ç®¡ç†è€…æ¨©é™ã¯ Firebase Custom Claims ã§ç®¡ç†ã—ã¾ã™ã€‚
ç®¡ç†ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦æ¨©é™ã‚’ä»˜ä¸ãƒ»ç¢ºèªã§ãã¾ã™ã€‚

### å‰ææ¡ä»¶: ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®å–å¾—

1. Firebase Console ã«ã‚¢ã‚¯ã‚»ã‚¹
   https://console.firebase.google.com/project/strengths-finder-auth/settings/serviceaccounts/adminsdk

2. ã€Œæ–°ã—ã„ç§˜å¯†éµã®ç”Ÿæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯

3. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `firebase-service-account.json` ã«ãƒªãƒãƒ¼ãƒ 

4. `scripts/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®

**æ³¨æ„**: ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `.gitignore` ã§é™¤å¤–ã•ã‚Œã¦ã„ã¾ã™ã€‚çµ¶å¯¾ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã§ãã ã•ã„ã€‚

### ç®¡ç†è€…æ¨©é™ã®ä»˜ä¸

```bash
npm run admin:set <email>

# ä¾‹
npm run admin:set suzuki.shunpei@altx.co.jp
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã®ç¢ºèª

```bash
npm run admin:list
```

### æ¨©é™åæ˜ ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’è¨­å®šã—ãŸå¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™:

1. ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ â†’ å†ãƒ­ã‚°ã‚¤ãƒ³
2. IDãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™åˆ‡ã‚Œã‚’å¾…ã¤ï¼ˆæœ€å¤§1æ™‚é–“ï¼‰

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã®ç®¡ç†è€…åˆ¤å®š

ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒï¼ˆFirebase Emulatorä½¿ç”¨æ™‚ï¼‰ã§ã¯ã€`useAuth.ts` ã® `LOCAL_ADMIN_EMAILS` é…åˆ—ã§ç®¡ç†è€…ã‚’åˆ¤å®šã—ã¾ã™ã€‚
æœ¬ç•ªç’°å¢ƒã§ã¯ Custom Claims ãŒå„ªå…ˆã•ã‚Œã¾ã™ã€‚

---

## å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | æ‹…å½“è€… |
|-----------|------|---------|--------|
| 1.0 | 2025-12-23 | åˆç‰ˆä½œæˆ | SUZUKI Shunpei |
| 1.1 | 2026-01-08 | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½è¿½åŠ ã€ç®¡ç†è€…æ¨©é™ç®¡ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ  | SUZUKI Shunpei |
