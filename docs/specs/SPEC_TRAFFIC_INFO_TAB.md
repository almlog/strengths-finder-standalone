# 交通情報タブ（Mini Tokyo 3D統合）仕様書

## 概要

Mini Tokyo 3D を統合し、東京の公共交通をリアルタイム3Dで可視化する新機能タブを追加する。
日常的なエンゲージメント向上と、勤怠管理（電車遅延確認）の両面で活用。

## ライセンス・利用条件

| 項目 | 内容 |
|------|------|
| ライブラリ | Mini Tokyo 3D |
| ライセンス | MIT License |
| 商用利用 | 可能 |
| 条件 | 著作権表示を保持 |
| 公式サイト | https://minitokyo3d.com/ |
| GitHub | https://github.com/nagix/mini-tokyo-3d |

## 必要なAPIトークン

| トークン | 用途 | 取得先 | 費用 | 必須 |
|---------|------|--------|------|------|
| Mapbox | 地図タイル | https://www.mapbox.com/ | 月50,000接続まで無料 | 必須 |
| ODPTセンター用 | 列車・旅客機データ | https://developer.odpt.org/ | 無料（登録まで数日） | 必須 |
| チャレンジ2025専用 | 追加データ | 公共交通オープンデータチャレンジ | 無料 | 任意 |

## 機能仕様

### Phase 1: 基本実装

#### 1.1 新規タブ追加

**タブ名:** 🚃 交通情報

**ナビゲーション位置:**
```
[メンバー管理] [個人分析] [部署分析] [チームシミュレーション] [勤怠分析] [🚃 交通情報]
```

#### 1.2 画面レイアウト

```
┌─────────────────────────────────────────────────────────────┐
│ 🚃 交通情報 - リアルタイム路線マップ                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                                                      │    │
│  │              Mini Tokyo 3D マップ                    │    │
│  │           (リアルタイム3D表示)                       │    │
│  │                                                      │    │
│  │                    [全画面表示]                      │    │
│  │                                                      │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
│  📝 使い方                                                   │
│  • マウスドラッグで視点移動、スクロールでズーム              │
│  • 電車アイコンをクリックで詳細表示                          │
│  • 遅延情報は各路線の色で表示                                │
│                                                              │
│  💡 電車遅延申請が必要な場合は「勤怠分析」タブを参照          │
└─────────────────────────────────────────────────────────────┘
```

#### 1.3 コンポーネント構成

```
src/
├── components/
│   └── traffic/
│       ├── TrafficInfoPage.tsx      # メインページ
│       ├── MiniTokyo3DMap.tsx       # マップコンポーネント
│       └── TrafficInfoGuide.tsx     # 使い方ガイド
├── types/
│   └── mini-tokyo-3d.d.ts           # 型定義
```

### Phase 2: ユーザー機能（将来実装）

#### 2.1 お気に入り路線
- よく使う路線を登録
- LocalStorageに保存
- クイック状況表示

#### 2.2 遅延アラート
- 登録路線の遅延を検知
- バッジ表示

### Phase 3: 勤怠連携（将来実装）

#### 3.1 勤怠分析からのリンク
- 遅刻違反がある場合にリンク表示
- 遅延情報の確認を促す

## 技術仕様

### 依存関係

```json
{
  "dependencies": {
    "mini-tokyo-3d": "^4.x"
  }
}
```

### 環境変数

```env
REACT_APP_MAPBOX_TOKEN=<Mapboxトークン>（必須）
REACT_APP_ODPT_TOKEN=<ODPTセンター用トークン>（必須）
REACT_APP_CHALLENGE_TOKEN=<チャレンジ2025専用トークン>（任意）
```

### 初期化コード

```typescript
import { Map } from 'mini-tokyo-3d';

const map = new Map({
  container: 'mini-tokyo-3d',
  accessToken: process.env.REACT_APP_MAPBOX_TOKEN,
  secrets: {
    odpt: process.env.REACT_APP_ODPT_TOKEN,
    challenge2025: process.env.REACT_APP_CHALLENGE_TOKEN
  }
});
```

### トークン未設定時の表示

APIトークンが設定されていない場合は、設定ガイドを表示:

```
┌─────────────────────────────────────────────────────────────┐
│ ⚠️ APIトークンの設定が必要です                               │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  Mini Tokyo 3D を利用するには、以下のAPIトークンが必要です:   │
│                                                              │
│  1. 公共交通オープンデータセンター                           │
│     → https://developer.odpt.org/ で無料登録                 │
│                                                              │
│  2. Mapbox                                                   │
│     → https://www.mapbox.com/ で無料登録                     │
│                                                              │
│  取得したトークンを .env ファイルに設定してください。         │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## UI/UX考慮事項

### レスポンシブ対応
- デスクトップ: フルサイズマップ
- モバイル: 縦長レイアウト、タッチ操作対応

### ダークモード対応
- Mini Tokyo 3D は独自のスタイルを持つため、コンテナのみダークモード適用

### パフォーマンス
- 遅延読み込み（React.lazy）で初期表示を高速化
- タブ切り替え時にマップを破棄してメモリ解放

## 著作権表示

MIT Licenseに従い、以下の著作権表示を含める:

```
Powered by Mini Tokyo 3D (MIT License)
© Akihiko Kusanagi
```

## テストケース

### 単体テスト
1. TrafficInfoPage がレンダリングされる
2. トークン未設定時に設定ガイドが表示される
3. マップコンテナが正しいサイズで表示される

### 統合テスト
1. タブ切り替えで交通情報ページに遷移できる
2. ダークモードでコンテナスタイルが適用される

## 実装手順

1. [ ] SPEC承認
2. [ ] 型定義ファイル作成
3. [ ] TrafficInfoPage コンポーネント作成
4. [ ] MiniTokyo3DMap コンポーネント作成
5. [ ] App.tsx にタブ追加
6. [ ] 環境変数テンプレート更新
7. [ ] ローカル動作確認
8. [ ] 本番適用

## 完了条件

- [ ] 新規タブ「🚃 交通情報」が表示される
- [ ] Mini Tokyo 3D マップが正しく表示される（トークン設定時）
- [ ] トークン未設定時は設定ガイドが表示される
- [ ] 著作権表示が含まれる
- [ ] ダークモードで表示が崩れない
- [ ] 既存機能に影響がない
